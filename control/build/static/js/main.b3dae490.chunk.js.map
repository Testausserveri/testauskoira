{"version":3,"sources":["welcomeHeader.svg","configuration.js","components/MailboxCard.js","components/MemberCard.js","components/MembersTable.js","App.js","index.js"],"names":["memberKeys","memberTableColumns","formatDate","str","date","Date","getDate","toString","padStart","getMonth","getFullYear","formatting","cleanMailboxName","name","trim","toLowerCase","replace","MailboxCard","props","useState","welcomeHeaderTemplate","setWelcomeHeaderTemplate","mailboxName","setMailboxName","forceShow","setForceShow","useEffect","console","log","welcomeHeaderFile","fetch","then","res","text","data","Object","keys","memberData","length","renderCanvas","username","a","canvas","document","querySelector","ctx","getContext","Canvg","fromString","start","register","window","confirm","toBlob","blob","formData","FormData","append","id","method","body","status","members","membersCopy","index","findIndex","member","registered","setMembers","updateMemberData","alert","href","onClick","event","preventDefault","setTimeout","focus","style","display","htmlFor","value","autoFocus","autoComplete","spellCheck","type","onKeyUp","key","click","onChange","target","MemberCard","map","memberDataKey","className","MembersTable","handleKeyPress","useCallback","setMemberData","addEventListener","removeEventListener","column","join","selectMember","App","json","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.b3dae490.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/welcomeHeader.ffb0c543.svg\";","export const apiServer = '';\n\nexport const memberKeys = {\n    \"id\": \"ID\",\n    \"username\": \"Käyttäjänimi\",\n    \"registered\": \"Postilaatikko\",\n    \"joinedTimestamp\": \"Liittynyt\",\n    \"createdAt\": \"Luotu\"\n};\nexport const memberTableColumns = [\n    \"id\",\n    \"createdAt\",\n    \"joinedTimestamp\",\n    \"username\",\n    \"registered\"\n];\n\nfunction formatDate(str) {\n    const date = new Date(str);\n    return `${(date.getDate()).toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`\n}\nexport const formatting = {\n    \"createdAt\": formatDate,\n    \"joinedTimestamp\": formatDate\n}","import Canvg from 'canvg';\nimport { useState, useEffect } from 'react';\nimport welcomeHeaderFile from '../welcomeHeader.svg';\nimport { apiServer } from '../configuration';\n\nfunction cleanMailboxName(name) {\n    return name.trim().toLowerCase().replace(/ /g, '.').replace(/ä/g, 'a').replace(/ö/g, 'o').replace(/[^0-9a-zA-Z.]/g, '');\n}\n\nfunction MailboxCard(props) {\n    const [ welcomeHeaderTemplate, setWelcomeHeaderTemplate ] = useState('');\n    const [ mailboxName, setMailboxName ] = useState('');\n    const [ forceShow, setForceShow ] = useState(false);\n\n    useEffect(() => {\n        console.log('Fetching welcomeHeader from ' + welcomeHeaderFile + '...');\n        fetch(welcomeHeaderFile)\n        .then(res => res.text())\n        .then(data => {\n            setWelcomeHeaderTemplate(data);\n        })\n    }, []);\n\n    useEffect(() => {\n        setForceShow(false);\n        if (Object.keys(props.memberData).length > 0) {\n            renderCanvas(props.memberData.username);     \n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [props.memberData])\n\n    const renderCanvas = async (username) => {\n        console.log('Rendering canvas...')\n        const name = cleanMailboxName(username);\n        setMailboxName(name);\n\n        const canvas = document.querySelector('canvas');\n        const ctx = canvas.getContext('2d');\n        const v = await Canvg.fromString(ctx, welcomeHeaderTemplate.replace('[name]', name).replace(/\\[size\\]/gi, (name.length > 13 ? '0.6em' : '0.7em')));\n\n        v.start();\n    }\n\n    const update = (name) => {\n        renderCanvas(name);    \n    }\n\n    const updateMemberData = () => {\n        console.log(props.members)\n        const membersCopy = [...props.members];\n        const index = membersCopy.findIndex(member => member.id === props.memberData.id)\n        membersCopy[index].registered = mailboxName;\n        props.setMembers(membersCopy);\n    }\n\n    const inputKeyUpEvent = (event) => {\n        if(event.key !== \"Enter\") return; \n        document.querySelector(\"#registerBtn\").click(); \n        event.preventDefault(); \n    };\n\n    const register = () => {\n        if (window.confirm(`Myönnät käyttäjälle ${props.memberData.username} sähköpostilaatikon ${mailboxName}@testausserveri.fi ja lähetät kyseiselle käyttäjälle Discord-viestin tästä jäsenedusta. Vahvista?`)) {\n            document.querySelector('canvas').toBlob(function(blob) {\n                const formData = new FormData();\n                formData.append('image', blob, mailboxName + '.png');\n                formData.append('id', props.memberData.id);\n                formData.append('mailbox', mailboxName);\n                fetch(apiServer + '/api/sendWelcome', {\n                    method: 'POST',\n                    body: formData\n                })\n                .then(res => {\n                    console.log(res)\n                    if (res.status === 200) {\n                        setForceShow(false);\n                        updateMemberData();\n                    } else {\n                        alert('Tapahtui jokin virhe. Älä myönnä käyttäjälle uutta sähköpostilaatikkoa. Ota yhteyttä järjestelmänvalvojaa.');\n                    }\n                })\n            });\n    \n        } else {\n            alert('Peruutettu');\n        }\n    }\n    return (\n        <div>\n            {(props.memberData.registered ? \n            <p>\n                <b>\n                    Jäsenellä on jo sähköpostilaatikko.&nbsp;\n                    <a href=\"#forceShow\" onClick={(event) => {event.preventDefault(); setForceShow(true); setTimeout(()=>{document.querySelector('#memberEmailInput').focus();}, 5)}}>Luo alias</a>\n                </b>\n            </p> \n            : \n            <p>\n                Jäsenellä ei ole vielä sähköpostilaatikkoa.\n            </p>\n            )}\n            <div style={(!!!props.memberData.registered || forceShow) ? {} : {display: 'none'}}>\n                <label htmlFor=\"memberEmailInput\">Sähköpostilaatikon nimi</label><br></br>\n                <input id=\"memberEmailInput\" value={mailboxName} autoFocus={true} autoComplete=\"off\" spellCheck=\"false\" type=\"text\" onKeyUp={inputKeyUpEvent} onChange={(event) => update(event.target.value)} />\n                <canvas></canvas><br /><br />\n                <input type=\"button\" id=\"registerBtn\" value=\"Rekisteröi ja lähetä viesti\" onClick={() => register()}/>\n            </div>\n        </div>\n    )\n}\n\nexport default MailboxCard;","import { memberKeys, formatting } from '../configuration';\n\nfunction MemberCard(props) {\n    return (\n        <table>\n            <tbody>\n                {Object.keys(props.memberData).map(memberDataKey => {\n                    return (\n                        <tr key={memberDataKey} className=\"memberCard\">\n                            <td>{memberKeys[memberDataKey] || memberDataKey}</td>\n                            <td>{formatting[memberDataKey] ? formatting[memberDataKey](props.memberData[memberDataKey]) : props.memberData[memberDataKey]}</td>\n                        </tr>\n                    )\n                })}\n            </tbody>\n        </table>\n    )\n}\n\nexport default MemberCard;","import { useCallback, useEffect } from 'react';\nimport {memberTableColumns, memberKeys, formatting} from '../configuration';\nfunction MembersTable(props) {\n    const handleKeyPress = useCallback(event => {\n        const key = event.key; \n        \n        if (key === 'ArrowUp' || key === 'ArrowDown') {\n            let index = props.members.findIndex(member => member.id === props.memberData.id);\n            console.log(props.members)\n            if (key === 'ArrowUp') {\n                index -= 1;\n                if (index <= 0) index = 0;\n            } else if (key === 'ArrowDown') {\n                index += 1;\n                if (index >= props.members.length - 1) index = props.members.length - 1;\n            }\n            console.log(index, props.members[index])\n            if (props.members[index]) {\n                props.setMemberData(props.members[index]);\n            }\n            setTimeout(()=>{document.querySelector('#memberEmailInput').focus();}, 5);\n        }\n    }, [props]);\n\n    useEffect(() => {\n        window.addEventListener('keydown', handleKeyPress);\n\n        return () => {\n          window.removeEventListener('keydown', handleKeyPress);\n        };\n    }, [handleKeyPress]);\n\n    const selectMember = (member) => {\n        props.setMemberData(member)\n        setTimeout(()=>{document.querySelector('#memberEmailInput').focus();}, 5);\n\n    };\n\n    return (\n        <table className=\"membersTable\">\n            <thead>\n                <tr>\n                    {memberTableColumns.map((column) => {\n                        return (\n                            <th key={column}>{memberKeys[column] || column}</th>\n                        )\n                    })}\n                </tr>\n            </thead>\n            <tbody>\n                {props.data.map(member => {\n                    return (\n                        <tr key={member.id} className={[\n                            (member.registered ? 'registeredMemberRow' : ''), \n                            (props.memberData.id === member.id ? 'selectedMemberRow': '')\n                            ].join(' ')} onClick={() => {selectMember(member)}}>\n                                {memberTableColumns.map((column) => {\n                                    return (\n                                        <td key={member.id + column}>\n                                            {member[column] ? (formatting[column] ? formatting[column](member[column]) : member[column]) : '-'}\n                                        </td>\n                                    )\n                                })}\n                        </tr>\n                    )\n                })}\n            </tbody>\n        </table>\n    )\n}\n\nexport default MembersTable;","import { useEffect, useState } from 'react';\nimport './styles/App.css';\nimport MailboxCard from './components/MailboxCard';\nimport MemberCard from './components/MemberCard';\nimport MembersTable from './components/MembersTable';\nimport { apiServer } from './configuration';\n\nfunction App() {\n    const [members, setMembers] = useState([]);\n    const [memberData, setMemberData] = useState({});\n    useEffect(() => {\n        console.log('Fetching data...');\n        fetch(apiServer + '/api/users')\n        .then(res => res.json())\n        .then(data => {\n            console.log('Member keys available', Object.keys(data[0]))\n            setMembers(data);\n            setMemberData(data[0]);\n        })\n    }, []);\n\n    return (\n        <div className=\"app\">\n            <div className=\"membersList\">\n                <MembersTable data={members} setMemberData={setMemberData} memberData={memberData} members={members} />\n            </div>\n            <div className=\"controlView\">\n                <div className=\"fixed\">\n                    <h1>Jäsenkortti</h1>\n                    <MemberCard memberData={memberData} />\n                    <h2>Postilaatikko</h2>\n                    <MailboxCard setMembers={setMembers} members={members} setMemberData={setMemberData} memberData={memberData} />\n                </div>\n            </div>\n        </div>\n    );\n}\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './styles/index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}