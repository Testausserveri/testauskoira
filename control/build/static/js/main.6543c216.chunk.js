(this["webpackJsonptestauskoira-web"]=this["webpackJsonptestauskoira-web"]||[]).push([[0],{186:function(e,t,n){},187:function(e,t,n){},389:function(e,t,n){"use strict";n.r(t);var r=n(19),a=n.n(r),c=n(172),i=n.n(c),s=(n(186),n(40)),o=(n(187),n(181)),m=n(114),l=n.n(m),u=n(173),b=n(174),d=n.p+"static/media/welcomeHeader.9986858a.svg",j={id:"ID",username:"K\xe4ytt\xe4j\xe4nimi",registered:"Postilaatikko",joinedTimestamp:"Liittynyt",createdAt:"Luotu"},f=["id","createdAt","joinedTimestamp","username","registered"];function h(e){var t=new Date(e);return"".concat(t.getDate().toString().padStart(2,"0"),"/").concat((t.getMonth()+1).toString().padStart(2,"0"),"/").concat(t.getFullYear())}var p={createdAt:h,joinedTimestamp:h},O=n(6);function v(e){return e.trim().toLowerCase().replace(/ /g,".").replace(/\xe4/g,"a").replace(/\xf6/g,"o").replace(/[^0-9a-zA-Z.]/g,"")}var x=function(e){var t=Object(r.useState)(""),n=Object(s.a)(t,2),a=n[0],c=n[1],i=Object(r.useState)(""),m=Object(s.a)(i,2),j=m[0],f=m[1],h=Object(r.useState)(!1),p=Object(s.a)(h,2),x=p[0],k=p[1];Object(r.useEffect)((function(){console.log("Fetching welcomeHeader from "+d+"..."),fetch(d).then((function(e){return e.text()})).then((function(e){c(e)}))}),[]),Object(r.useEffect)((function(){k(!1),Object.keys(e.memberData).length>0&&g(e.memberData.username)}),[e.memberData]);var g=function(){var e=Object(u.a)(l.a.mark((function e(t){var n,r,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Rendering canvas..."),n=v(t),f(n),r=document.querySelector("canvas"),c=r.getContext("2d"),e.next=7,b.a.fromString(c,a.replace("[name]",n).replace(/\[size\]/gi,n.length>13?"0.4em":"0.7em"));case 7:e.sent.start();case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){window.confirm("My\xf6nn\xe4t k\xe4ytt\xe4j\xe4lle ".concat(e.memberData.username," s\xe4hk\xf6postilaatikon ").concat(j,"@testausserveri.fi ja l\xe4het\xe4t kyseiselle k\xe4ytt\xe4j\xe4lle Discord-viestin t\xe4st\xe4 j\xe4senedusta. Vahvista?"))?document.querySelector("canvas").toBlob((function(t){var n=new FormData;n.append("image",t,j+".png"),n.append("id",e.memberData.id),n.append("mailbox",j),fetch("/api/sendWelcome",{method:"POST",body:n}).then((function(t){console.log(t),200===t.status?(k(!1),function(){console.log(e.members);var t=Object(o.a)(e.members),n=t.findIndex((function(t){return t.id===e.memberData.id}));t[n].registered=j,e.setMembers(t)}()):alert("Tapahtui jokin virhe. \xc4l\xe4 my\xf6nn\xe4 k\xe4ytt\xe4j\xe4lle uutta s\xe4hk\xf6postilaatikkoa. Ota yhteytt\xe4 j\xe4rjestelm\xe4nvalvojaa.")}))})):alert("Peruutettu")};return Object(O.jsxs)("div",{children:[e.memberData.registered?Object(O.jsx)("p",{children:Object(O.jsxs)("b",{children:["J\xe4senell\xe4 on jo s\xe4hk\xf6postilaatikko.\xa0",Object(O.jsx)("a",{href:"#forceShow",onClick:function(e){e.preventDefault(),k(!0),setTimeout((function(){document.querySelector("#memberEmailInput").focus()}),5)},children:"Luo alias"})]})}):Object(O.jsx)("p",{children:"J\xe4senell\xe4 ei ole viel\xe4 s\xe4hk\xf6postilaatikkoa."}),Object(O.jsxs)("div",{style:!e.memberData.registered||x?{}:{display:"none"},children:[Object(O.jsx)("label",{htmlFor:"memberEmailInput",children:"S\xe4hk\xf6postilaatikon nimi"}),Object(O.jsx)("br",{}),Object(O.jsx)("input",{id:"memberEmailInput",value:j,autoFocus:!0,autoComplete:"off",spellCheck:"false",type:"text",onKeyUp:function(e){"Enter"===e.key&&(document.querySelector("#registerBtn").click(),e.preventDefault())},onChange:function(e){return t=e.target.value,void g(t);var t}}),Object(O.jsx)("canvas",{}),Object(O.jsx)("br",{}),Object(O.jsx)("br",{}),Object(O.jsx)("input",{type:"button",id:"registerBtn",value:"Rekister\xf6i ja l\xe4het\xe4 viesti",onClick:function(){return y()}})]})]})};var k=function(e){return Object(O.jsx)("table",{children:Object(O.jsx)("tbody",{children:Object.keys(e.memberData).map((function(t){return Object(O.jsxs)("tr",{className:"memberCard",children:[Object(O.jsx)("td",{children:j[t]||t}),Object(O.jsx)("td",{children:p[t]?p[t](e.memberData[t]):e.memberData[t]})]},t)}))})})};var g=function(e){var t=Object(r.useCallback)((function(t){var n=t.key;if("ArrowUp"===n||"ArrowDown"===n){var r=e.members.findIndex((function(t){return t.id===e.memberData.id}));console.log(e.members),"ArrowUp"===n?(r-=1)<=0&&(r=0):"ArrowDown"===n&&(r+=1)>=e.members.length-1&&(r=e.members.length-1),console.log(r,e.members[r]),e.members[r]&&e.setMemberData(e.members[r]),setTimeout((function(){document.querySelector("#memberEmailInput").focus()}),5)}}),[e]);return Object(r.useEffect)((function(){return window.addEventListener("keydown",t),function(){window.removeEventListener("keydown",t)}}),[t]),Object(O.jsxs)("table",{className:"membersTable",children:[Object(O.jsx)("thead",{children:Object(O.jsx)("tr",{children:f.map((function(e){return Object(O.jsx)("th",{children:j[e]||e},e)}))})}),Object(O.jsx)("tbody",{children:e.data.map((function(t){return Object(O.jsx)("tr",{className:[t.registered?"registeredMemberRow":"",e.memberData.id===t.id?"selectedMemberRow":""].join(" "),onClick:function(){!function(t){e.setMemberData(t),setTimeout((function(){document.querySelector("#memberEmailInput").focus()}),5)}(t)},children:f.map((function(e){return Object(O.jsx)("td",{children:t[e]?p[e]?p[e](t[e]):t[e]:"-"},t.id+e)}))},t.id)}))})]})};var y=function(){var e=Object(r.useState)([]),t=Object(s.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)({}),i=Object(s.a)(c,2),o=i[0],m=i[1];return Object(r.useEffect)((function(){console.log("Fetching data..."),fetch("/api/users").then((function(e){return e.json()})).then((function(e){console.log("Member keys available",Object.keys(e[0])),a(e),m(e[0])}))}),[]),Object(O.jsxs)("div",{className:"app",children:[Object(O.jsx)("div",{className:"membersList",children:Object(O.jsx)(g,{data:n,setMemberData:m,memberData:o,members:n})}),Object(O.jsx)("div",{className:"controlView",children:Object(O.jsxs)("div",{className:"fixed",children:[Object(O.jsx)("h1",{children:"J\xe4senkortti"}),Object(O.jsx)(k,{memberData:o}),Object(O.jsx)("h2",{children:"Postilaatikko"}),Object(O.jsx)(x,{setMembers:a,members:n,setMemberData:m,memberData:o})]})})]})};i.a.render(Object(O.jsx)(a.a.StrictMode,{children:Object(O.jsx)(y,{})}),document.getElementById("root"))}},[[389,1,2]]]);
//# sourceMappingURL=main.6543c216.chunk.js.map